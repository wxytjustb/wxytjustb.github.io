"use strict";(self.webpackChunkroky_wang=self.webpackChunkroky_wang||[]).push([[1413],{1598:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>s,metadata:()=>c,toc:()=>a});var n=o(4848),t=o(8453);const s={title:"Prometheus Operator\u4f7f\u7528\u7b80\u4ecb"},i=void 0,c={id:"CloudNative/prometheus/operator",title:"Prometheus Operator\u4f7f\u7528\u7b80\u4ecb",description:"Prometheus Operator\u7b80\u4ecb",source:"@site/docs/CloudNative/prometheus/operator.md",sourceDirName:"CloudNative/prometheus",slug:"/CloudNative/prometheus/operator",permalink:"/docs/CloudNative/prometheus/operator",draft:!1,unlisted:!1,editUrl:"https://github.com/wxytjustb/rokywang/tree/main/docs/CloudNative/prometheus/operator.md",tags:[],version:"current",frontMatter:{title:"Prometheus Operator\u4f7f\u7528\u7b80\u4ecb"},sidebar:"tutorialSidebar",previous:{title:"golang",permalink:"/docs/CloudNative/prometheus/golang"},next:{title:"helm\u6258\u7ba1",permalink:"/docs/CloudNative/tke/helm\u6258\u7ba1"}},l={},a=[{value:"Prometheus Operator\u7b80\u4ecb",id:"prometheus-operator\u7b80\u4ecb",level:3},{value:"ServiceMonitor/PodMonitor",id:"servicemonitorpodmonitor",level:3},{value:"PrometheusRule",id:"prometheusrule",level:3}];function d(e){const r={code:"code",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h3,{id:"prometheus-operator\u7b80\u4ecb",children:"Prometheus Operator\u7b80\u4ecb"}),"\n",(0,n.jsx)(r.p,{children:"Prometheus Operator\u5305\u542b\u4ee5\u4e0bCRD\u8d44\u6e90\uff0c\u5206\u522b\u5bf9\u5e94prometheus\u5bf9\u5e94\u7684\u914d\u7f6e\u3002"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"Prometheus"})}),", \u5b9a\u4e49\u5b9e\u4f8bPrometheus\u7684\u90e8\u7f72"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"Alertmanager"})}),",  \u5b9a\u4e49\u5b9e\u4f8bAlertmanager\u7684\u90e8\u7f72"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"ThanosRuler"})}),",\u5b9a\u4e49Thanos Ruler\u7684\u90e8\u7f72."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"ServiceMonitor"})}),", \u57fa\u4e8eService\u6765\u6293\u53d6metrics\u6570\u636e"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"PodMonitor"})}),", \u57fa\u4e8ePod\u6765\u6293\u53d6metrics\u6570\u636e"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"Probe"})}),", which declaratively specifies how groups of ingresses or static targets should be monitored. The Operator automatically generates Prometheus scrape configuration based on the definition."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"PrometheusRule"})}),", Prometheus alerting\u548crecording rules\u7684\u5b9a\u4e49"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"AlertmanagerConfig"})}),",  Alertmanager configuration\u7684\u914d\u7f6e\u4fe1\u606f"]}),"\n"]}),"\n",(0,n.jsx)(r.h3,{id:"servicemonitorpodmonitor",children:"ServiceMonitor/PodMonitor"}),"\n",(0,n.jsx)(r.p,{children:"ServiceMonitor\u548cPodMonitor\u90fd\u662f\u5b9a\u4e49\u4e00\u7ec4Endpoint\u7684\u76ee\u6807\u6293\u53d6\uff0cServiceMonitor\u6839\u636eselector\u5b57\u6bb5\u6765\u627e\u5230\u5bf9\u5e94Service\u540e\u7aef\u7684Endpoints\u6765\u8fdb\u884c\u6570\u636e\u6293\u53d6\uff0cEndpoint\u6709\u53ef\u80fd\u662fPod ip\uff0c\u4e5f\u6709\u53ef\u80fd\u662f\u7269\u7406\u673a\u6216\u865a\u62df\u673aip\u3002PodMonitor\u76f4\u63a5\u6839\u636eselector\u5339\u914d\u7684pod\u4fe1\u606f\u6765\u8fdb\u884c\u6293\u53d6\uff0c\u4e24\u4e2a\u7ef4\u5ea6\u4e0d\u4e00\u6837\uff0c\u67d0\u4e9b\u573a\u666f\u4e0b\u4e24\u8005\u90fd\u53ef\u4ee5\u4f7f\u7528\u3002"}),"\n",(0,n.jsx)(r.p,{children:"\u914d\u7f6e\u793a\u4f8b"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",children:"apiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: go-demo    # \u586b\u5199\u4e00\u4e2a\u552f\u4e00\u540d\u79f0\n  namespace: cm-prometheus  # namespace\u56fa\u5b9a\uff0c\u4e0d\u8981\u4fee\u6539\nspec:\n  endpoints:\n  - interval: 30s\n    # \u586b\u5199service yaml\u4e2dPrometheus Exporter\u5bf9\u5e94\u7684Port\u7684Name\n    port: 8080-8080-tcp\n    # \u586b\u5199Prometheus Exporter\u5bf9\u5e94\u7684Path\u7684\u503c\uff0c\u4e0d\u586b\u9ed8\u8ba4/metrics\n    path: /metrics\n    relabelings:\n    # ** \u5fc5\u987b\u8981\u6709\u4e00\u4e2a label \u4e3a application\uff0c\u8fd9\u91cc\u5047\u8bbe k8s \u6709\u4e00\u4e2a label \u4e3a app\uff0c\n    # \u6211\u4eec\u901a\u8fc7 relabel \u7684 replace \u52a8\u4f5c\u628a\u5b83\u66ff\u6362\u6210\u4e86 application\n    - action: replace\n      sourceLabels:  [__meta_kubernetes_pod_label_app]\n      targetLabel: application\n  # \u9009\u62e9\u8981\u76d1\u63a7service\u6240\u5728\u7684namespace\n  namespaceSelector:\n    matchNames:\n    - golang-demo\n  # \u586b\u5199\u8981\u76d1\u63a7service\u7684Label\u503c\uff0c\u4ee5\u5b9a\u4f4d\u76ee\u6807service\n  selector:\n    matchLabels:\n      app: golang-app-demo\n"})}),"\n",(0,n.jsx)(r.p,{children:"\u67e5\u770b\u662f\u5426\u751f\u6548\uff0c\u767b\u5f55prometheus\u9875\u9762"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"k -n kubesphere-monitoring-system port-forward prometheus-k8s-0 9090\n"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"servicemontor",src:o(2763).A+"",width:"1238",height:"610"})}),"\n",(0,n.jsx)(r.p,{children:"\u786e\u5b9aTarget\u91cc\u6709\u5bf9\u5e94\u7684Endpoint\uff0c\u5e76\u4e14\u4e3aup\u72b6\u6001\u5373\u53ef\u3002"}),"\n",(0,n.jsx)(r.h3,{id:"prometheusrule",children:"PrometheusRule"})]})}function p(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},2763:(e,r,o)=>{o.d(r,{A:()=>n});const n=o.p+"assets/images/servicemontor-c2c71f817ad40e2e6187de410420de58.png"},8453:(e,r,o)=>{o.d(r,{R:()=>i,x:()=>c});var n=o(6540);const t={},s=n.createContext(t);function i(e){const r=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),n.createElement(s.Provider,{value:r},e.children)}}}]);