"use strict";(self.webpackChunkroky_wang=self.webpackChunkroky_wang||[]).push([[2660],{4311:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>l});var i=s(4848),o=s(8453);const a={},r=void 0,t={id:"MiddleWare/apigateway/apisix_issues",title:"apisix_issues",description:"\u63d2\u4ef6\u6253\u5370\u65e5\u5fd7",source:"@site/docs/MiddleWare/apigateway/apisix_issues.md",sourceDirName:"MiddleWare/apigateway",slug:"/MiddleWare/apigateway/apisix_issues",permalink:"/en/docs/MiddleWare/apigateway/apisix_issues",draft:!1,unlisted:!1,editUrl:"https://github.com/wxytjustb/rokywang/tree/main/docs/MiddleWare/apigateway/apisix_issues.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Apache APISIX\u7f51\u5173",permalink:"/en/docs/MiddleWare/apigateway/apisix"},next:{title:"Caddy Server",permalink:"/en/docs/MiddleWare/caddy"}},c={},l=[];function d(e){const n={code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"\u63d2\u4ef6\u6253\u5370\u65e5\u5fd7"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"core.log.warn(core.json.encode(conf))\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6e90\u7801\u5206\u6790"}),"\n",(0,i.jsx)(n.p,{children:"/usr/local/apisix/apisix/plugins/openid-connect.lua"}),"\n",(0,i.jsx)(n.p,{children:"\u63d2\u4ef6\u5165\u53e3"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lua",children:"function _M.rewrite(plugin_conf, ctx)\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5904\u7406code\u903b\u8f91"}),"\n",(0,i.jsx)(n.p,{children:"/usr/local/apisix/deps/share/lua/5.1/resty/openidc.lua"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lua",children:'-- handle a "code" authorization response from the OP\n-- \u4e3b\u8981\u5904\u7406code\uff0c\u7136\u540e\u5c06\u7528\u6237\u76f8\u5173\u4fe1\u606f\u4fdd\u5b58\u5728session.data\u91cc\nlocal function openidc_authorization_response(opts, session)\n  \n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5904\u7406session\u6d41\u7a0b"}),"\n",(0,i.jsx)(n.p,{children:"/usr/local/apisix/deps/share/lua/5.1/resty/session.lua"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lua",children:'-- \u4fdd\u5b58session\nlocal function save(session, close)\n    -- \u4fdd\u5b58session\u7684\u65f6\u5019\u4f1a\u8fd4\u56decookie\u8bbe\u7f6e\n    session.expires = session.now + session.cookie.lifetime\n\n    set_usebefore(session)\n\n    local cookie, err = session.strategy.save(session, close)\n    if not cookie then\n        return nil, err or "unable to save session cookie"\n    end\n\n    return set_cookie(session, cookie)\nend\n\n--\nlocal function set_cookie(session, value, expires)\n    -- \u57fa\u4e8ecookie\u5927\u5c0f\u6765\u8fdb\u884ccookie\u7684\u5206\u5757\n    if expires then\n        -- expiring cookie, so deleting data. Do not measure data, but use\n        -- existing chunk count to make sure we clear all of them\n        cookie_parts = cookie.chunks or 1\n    else\n        -- calculate required chunks from data\n        cookie_chunks = max(ceil(#value / cookie.maxsize), 1)\n        cookie_parts = max(cookie_chunks, cookie.chunks or 1)\n    end\n    ...\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"{% if enable_http then %}\nhttp {\n    # \u52a0\u4e0a\u4ee5\u4e0b\u914d\u7f6e\uff0c\u63d0\u5347header\u6700\u5927\u503c\n    proxy_buffer_size 128k;\n    proxy_buffers 32 32k;\n    proxy_busy_buffers_size 128k;\n    client_header_buffer_size 20k;\n    large_client_header_buffers 4 20k;\n    \n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>t});var i=s(6540);const o={},a=i.createContext(o);function r(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);