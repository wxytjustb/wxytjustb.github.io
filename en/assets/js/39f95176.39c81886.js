"use strict";(self.webpackChunkroky_wang=self.webpackChunkroky_wang||[]).push([[6429],{6336:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var r=t(4848),o=t(8453);const s={},a=void 0,i={id:"CloudNative/prometheus/golang",title:"golang",description:"golang metrics\u96c6\u6210",source:"@site/docs/CloudNative/prometheus/golang.md",sourceDirName:"CloudNative/prometheus",slug:"/CloudNative/prometheus/golang",permalink:"/en/docs/CloudNative/prometheus/golang",draft:!1,unlisted:!1,editUrl:"https://github.com/wxytjustb/rokywang/tree/main/docs/CloudNative/prometheus/golang.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"openebs",permalink:"/en/docs/CloudNative/openebs"},next:{title:"Prometheus Operator\u4f7f\u7528\u7b80\u4ecb",permalink:"/en/docs/CloudNative/prometheus/operator"}},c={},l=[{value:"go client\u96c6\u6210",id:"go-client\u96c6\u6210",level:3},{value:"Prometheus pull\u65b9\u5f0f\u91c7\u96c6\u6570\u636e",id:"prometheus-pull\u65b9\u5f0f\u91c7\u96c6\u6570\u636e",level:3},{value:"Prometheus push\u65b9\u5f0f\u91c7\u96c6\u6570\u636e",id:"prometheus-push\u65b9\u5f0f\u91c7\u96c6\u6570\u636e",level:3},{value:"Grafana \u663e\u793a",id:"grafana-\u663e\u793a",level:3}];function p(e){const n={a:"a",code:"code",h3:"h3",img:"img",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"golang metrics\u96c6\u6210"}),"\n",(0,r.jsx)(n.p,{children:"golang metrics\u96c6\u6210\u5230prometheus\u4e2d\uff0c\u7136\u540e\u901a\u8fc7grafana\u5c55\u793a\u51fa\u6765"}),"\n",(0,r.jsx)(n.h3,{id:"go-client\u96c6\u6210",children:"go client\u96c6\u6210"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'package main\nimport (\n        "net/http"\n\n        "github.com/prometheus/client_golang/prometheus/promhttp"\n)\nfunc main() {\n        http.Handle("/metrics", promhttp.Handler())\n        http.ListenAndServe(":2112", nil)\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="gin \u96c6\u6210"',children:'func PrometheusHandler(c *gin.Context) {\n\tpromhttp.Handler().ServeHTTP(c.Writer, c.Request)\n}\n\nfunc main() {\n\trouter := gin.Default()\n\trouter.GET("/metrics", PrometheusHandler)\n  // ...\t\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528helm\u5c01\u88c5\uff0c\u7136\u540e\u90e8\u7f72"}),"\n",(0,r.jsx)(n.h3,{id:"prometheus-pull\u65b9\u5f0f\u91c7\u96c6\u6570\u636e",children:"Prometheus pull\u65b9\u5f0f\u91c7\u96c6\u6570\u636e"}),"\n",(0,r.jsx)(n.p,{children:"kubekey\u5df2\u5c06prometheus-operator\u90e8\u7f72\u597d\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528ServiceMonitor"}),"\n",(0,r.jsx)(n.p,{children:"\u57fa\u4e8ePodMonitor\u6765\u8fdb\u884c\u6570\u636e\u91c7\u96c6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: monitoring.coreos.com/v1\nkind: PodMonitor\nmetadata:\n  name: go-server # \u586b\u5199\u4e00\u4e2a\u552f\u4e00\u540d\u79f0\nspec:\n  podMetricsEndpoints:\n  - interval: 30s\n    port: http  # \u586b\u5199pod yaml\u4e2dPrometheus Exporter\u5bf9\u5e94\u7684Port\u7684Name\n    path: /metrics  # \u586b\u5199Prometheus Exporter\u5bf9\u5e94\u7684Path\u7684\u503c\uff0c\u4e0d\u586b\u9ed8\u8ba4/metrics\n  namespaceSelector:   # \u9009\u62e9\u8981\u76d1\u63a7pod\u6240\u5728\u7684namespace\n    matchNames:\n    - default\n  selector:    # \u586b\u5199\u8981\u76d1\u63a7pod\u7684Label\u503c\uff0c\u4ee5\u5b9a\u4f4d\u76ee\u6807pod\n    matchLabels:\n      k8s-app: redis-exporter\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4e5f\u53ef\u4ee5\u57fa\u4e8eServiceMonitor\u6765\u8fdb\u884c\u6570\u636e\u91c7\u96c6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="service_monitor.yaml"',children:"apiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: go-demo    # \u586b\u5199\u4e00\u4e2a\u552f\u4e00\u540d\u79f0\nspec:\n  endpoints:\n  - interval: 30s\n    # \u586b\u5199service yaml\u4e2dPrometheus Exporter\u5bf9\u5e94\u7684Port\u7684Name\n    port: http\n    # \u586b\u5199Prometheus Exporter\u5bf9\u5e94\u7684Path\u7684\u503c\uff0c\u4e0d\u586b\u9ed8\u8ba4/metrics\n    path: /metrics\n  # \u9009\u62e9\u8981\u76d1\u63a7service\u6240\u5728\u7684namespace\n  namespaceSelector:\n    matchNames:\n    - default\n  # \u586b\u5199\u8981\u76d1\u63a7service\u7684Label\u503c\uff0c\u4ee5\u5b9a\u4f4d\u76ee\u6807service\n  selector:\n    matchLabels:\n      app.kubernetes.io/instance: go-demo-server\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"# \u6267\u884cservice monitor\nk apply -f service_monitor.yaml\n\n# \u5728Prometheus\u91cc\u67e5\u770b\u662f\u5426\u6293\u53d6\u6210\u529f\nkubectl --namespace kubesphere-monitoring-system port-forward prometheus-k8s-0 7890:9090\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u8fdb\u5165",(0,r.jsx)(n.a,{href:"http://127.0.0.1:7890/targets%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%8F%91%E7%8E%B0%E8%BF%99%E4%B8%AAEndpoint%EF%BC%8C%E8%AF%B4%E6%98%8E%E6%95%B0%E6%8D%AE%E6%8A%93%E5%8F%96%E6%88%90%E5%8A%9F",children:"http://127.0.0.1:7890/targets\u9875\u9762\uff0c\u53d1\u73b0\u8fd9\u4e2aEndpoint\uff0c\u8bf4\u660e\u6570\u636e\u6293\u53d6\u6210\u529f"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"golang",src:t(9201).A+"",width:"2830",height:"442"})}),"\n",(0,r.jsx)(n.h3,{id:"prometheus-push\u65b9\u5f0f\u91c7\u96c6\u6570\u636e",children:"Prometheus push\u65b9\u5f0f\u91c7\u96c6\u6570\u636e"}),"\n",(0,r.jsx)(n.h3,{id:"grafana-\u663e\u793a",children:"Grafana \u663e\u793a"}),"\n",(0,r.jsx)(n.p,{children:"\u53ef\u4ee5\u4f7f\u7528\u9ed8\u8ba4\u7684granafa dashboard\u8fdb\u884c\u5c55\u793a\uff0c\u7136\u540e\u5728\u6b64\u57fa\u7840\u4e0a\u8fdb\u884c\u6269\u5c55"}),"\n",(0,r.jsxs)(n.p,{children:["dashboard\u5730\u5740 ",(0,r.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/10826-go-metrics/",children:"https://grafana.com/grafana/dashboards/10826-go-metrics/"})]}),"\n",(0,r.jsxs)(n.p,{children:["json\u6587\u4ef6\u4e0b\u8f7d ",(0,r.jsx)(n.a,{href:"https://grafana.com/api/dashboards/10826/revisions/1/download",children:"https://grafana.com/api/dashboards/10826/revisions/1/download"})]}),"\n",(0,r.jsx)(n.p,{children:"\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u66f4\u6539\u9ed8\u8ba4\u7684json\u6587\u4ef6\uff0c\u663e\u793a\u6548\u679c\u5982\u4e0b\u56fe\u6240\u793a\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"golang_1",src:t(4449).A+"",width:"3676",height:"1858"})}),"\n",(0,r.jsx)(n.p,{children:"\u53c2\u8003\u6587\u6863"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://prometheus.io/docs/guides/go-application/",children:"https://prometheus.io/docs/guides/go-application/"})})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},9201:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/golang-a662498fc5bb1ab8aa5acc2b210d2040.png"},4449:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/golang_1-79749304e6e11639fdbac541af56f144.png"},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var r=t(6540);const o={},s=r.createContext(o);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);